import{SvelteComponent as x,init as $,safe_not_equal as ee,svg_element as R,claim_svg_element as V,children as L,detach as y,attr as h,insert_hydration as S,append_hydration as w,noop as B,element as P,text as O,space as Y,claim_element as T,claim_text as F,claim_space as Z,toggle_class as v,set_data as G,createEventDispatcher as _e,onMount as Ue,onDestroy as We,set_style as D,empty as q,group_outros as ce,transition_out as N,check_outros as he,transition_in as W,create_slot as ge,action_destroyer as Ce,update_slot_base as me,get_all_dirty_from_scope as pe,get_slot_changes as be,is_function as De,listen as Ne,create_component as Se,claim_component as ze,mount_component as Oe,destroy_component as Fe,tick as Ie}from"../../../svelte/svelte.js";import"../../../svelte/svelte-submodules.js";import{G as je}from"./2.CDVdg6R9.js";/* empty css                                             */function Be(l){let e,t,r,n;return{c(){e=R("svg"),t=R("path"),r=R("polyline"),n=R("line"),this.h()},l(u){e=V(u,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var d=L(e);t=V(d,"path",{d:!0}),L(t).forEach(y),r=V(d,"polyline",{points:!0}),L(r).forEach(y),n=V(d,"line",{x1:!0,y1:!0,x2:!0,y2:!0}),L(n).forEach(y),d.forEach(y),this.h()},h(){h(t,"d","M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"),h(r,"points","17 8 12 3 7 8"),h(n,"x1","12"),h(n,"y1","3"),h(n,"x2","12"),h(n,"y2","15"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"width","90%"),h(e,"height","90%"),h(e,"viewBox","0 0 24 24"),h(e,"fill","none"),h(e,"stroke","currentColor"),h(e,"stroke-width","2"),h(e,"stroke-linecap","round"),h(e,"stroke-linejoin","round"),h(e,"class","feather feather-upload")},m(u,d){S(u,e,d),w(e,t),w(e,r),w(e,n)},p:B,i:B,o:B,d(u){u&&y(e)}}}let tt=class extends x{constructor(e){super(),$(this,e,null,Be,ee,{})}};function fe(l){let e,t,r,n,u=j(l[2])+"",d,c,a,s,i=l[2].orig_name+"",f;return{c(){e=P("div"),t=P("span"),r=P("div"),n=P("progress"),d=O(u),a=Y(),s=P("span"),f=O(i),this.h()},l(_){e=T(_,"DIV",{class:!0});var g=L(e);t=T(g,"SPAN",{});var m=L(t);r=T(m,"DIV",{class:!0});var E=L(r);n=T(E,"PROGRESS",{style:!0,max:!0,class:!0});var A=L(n);d=F(A,u),A.forEach(y),E.forEach(y),m.forEach(y),a=Z(g),s=T(g,"SPAN",{class:!0});var C=L(s);f=F(C,i),C.forEach(y),g.forEach(y),this.h()},h(){D(n,"visibility","hidden"),D(n,"height","0"),D(n,"width","0"),n.value=c=j(l[2]),h(n,"max","100"),h(n,"class","svelte-1vsfomn"),h(r,"class","progress-bar svelte-1vsfomn"),h(s,"class","file-name svelte-1vsfomn"),h(e,"class","file svelte-1vsfomn")},m(_,g){S(_,e,g),w(e,t),w(t,r),w(r,n),w(n,d),w(e,a),w(e,s),w(s,f)},p(_,g){g&4&&u!==(u=j(_[2])+"")&&G(d,u),g&4&&c!==(c=j(_[2]))&&(n.value=c),g&4&&i!==(i=_[2].orig_name+"")&&G(f,i)},d(_){_&&y(e)}}}function Me(l){let e,t,r,n=l[0].length+"",u,d,c=l[0].length>1?"files":"file",a,s,i,f=l[2]&&fe(l);return{c(){e=P("div"),t=P("span"),r=O("Uploading "),u=O(n),d=Y(),a=O(c),s=O("..."),i=Y(),f&&f.c(),this.h()},l(_){e=T(_,"DIV",{class:!0});var g=L(e);t=T(g,"SPAN",{class:!0});var m=L(t);r=F(m,"Uploading "),u=F(m,n),d=Z(m),a=F(m,c),s=F(m,"..."),m.forEach(y),i=Z(g),f&&f.l(g),g.forEach(y),this.h()},h(){h(t,"class","uploading svelte-1vsfomn"),h(e,"class","wrap svelte-1vsfomn"),v(e,"progress",l[1])},m(_,g){S(_,e,g),w(e,t),w(t,r),w(t,u),w(t,d),w(t,a),w(t,s),w(e,i),f&&f.m(e,null)},p(_,[g]){g&1&&n!==(n=_[0].length+"")&&G(u,n),g&1&&c!==(c=_[0].length>1?"files":"file")&&G(a,c),_[2]?f?f.p(_,g):(f=fe(_),f.c(),f.m(e,null)):f&&(f.d(1),f=null),g&2&&v(e,"progress",_[1])},i:B,o:B,d(_){_&&y(e),f&&f.d()}}}function j(l){return l.progress*100/(l.size||0)||0}function Re(l){let e=0;return l.forEach(t=>{e+=j(t)}),document.documentElement.style.setProperty("--upload-progress-width",(e/l.length).toFixed(2)+"%"),e/l.length}function Ve(l,e,t){let{upload_id:r}=e,{root:n}=e,{files:u}=e,{stream_handler:d}=e,c,a=!1,s,i,f=u.map(m=>({...m,progress:0}));const _=_e();function g(m,E){t(0,f=f.map(A=>(A.orig_name===m&&(A.progress+=E),A)))}return Ue(async()=>{if(c=await d(new URL(`${n}/gradio_api/upload_progress?upload_id=${r}`)),c==null)throw new Error("Event source is not defined");c.onmessage=async function(m){const E=JSON.parse(m.data);a||t(1,a=!0),E.msg==="done"?(c==null||c.close(),_("done")):(t(7,s=E),g(E.orig_name,E.chunk_size))}}),We(()=>{(c!=null||c!=null)&&c.close()}),l.$$set=m=>{"upload_id"in m&&t(3,r=m.upload_id),"root"in m&&t(4,n=m.root),"files"in m&&t(5,u=m.files),"stream_handler"in m&&t(6,d=m.stream_handler)},l.$$.update=()=>{l.$$.dirty&1&&Re(f),l.$$.dirty&129&&t(2,i=s||f[0])},[f,a,i,r,n,u,d,s]}class Ge extends x{constructor(e){super(),$(this,e,Ve,Me,ee,{upload_id:3,root:4,files:5,stream_handler:6})}}function qe(){let l,e;return{drag(t,r={}){e=r;function n(){l=document.createElement("input"),l.type="file",l.style.display="none",l.setAttribute("aria-label","File upload"),l.setAttribute("data-testid","file-upload");const f=Array.isArray(e.accepted_types)?e.accepted_types.join(","):e.accepted_types||void 0;f&&(l.accept=f),l.multiple=e.mode==="multiple"||!1,e.mode==="directory"&&(l.webkitdirectory=!0,l.setAttribute("directory",""),l.setAttribute("mozdirectory","")),t.appendChild(l)}n();function u(f){f.preventDefault(),f.stopPropagation()}function d(f){var _;f.preventDefault(),f.stopPropagation(),(_=e.on_drag_change)==null||_.call(e,!0)}function c(f){var _;f.preventDefault(),f.stopPropagation(),(_=e.on_drag_change)==null||_.call(e,!1)}function a(f){var g,m,E;if(f.preventDefault(),f.stopPropagation(),(g=e.on_drag_change)==null||g.call(e,!1),!((m=f.dataTransfer)!=null&&m.files))return;const _=Array.from(f.dataTransfer.files);_.length>0&&((E=e.on_files)==null||E.call(e,_))}function s(){e.disable_click||(l.value="",l.click())}function i(){var f;if(l.files){const _=Array.from(l.files);_.length>0&&((f=e.on_files)==null||f.call(e,_))}}return t.addEventListener("drag",u),t.addEventListener("dragstart",u),t.addEventListener("dragend",u),t.addEventListener("dragover",u),t.addEventListener("dragenter",d),t.addEventListener("dragleave",c),t.addEventListener("drop",a),t.addEventListener("click",s),l.addEventListener("change",i),{update(f){e=f,l.remove(),n(),l.addEventListener("change",i)},destroy(){t.removeEventListener("drag",u),t.removeEventListener("dragstart",u),t.removeEventListener("dragend",u),t.removeEventListener("dragover",u),t.removeEventListener("dragenter",d),t.removeEventListener("dragleave",c),t.removeEventListener("drop",a),t.removeEventListener("click",s),l.removeEventListener("change",i),l.remove()}}},open_file_upload(){l&&(l.value="",l.click())}}}function He(l){let e,t,r,n,u,d,c;const a=l[30].default,s=ge(a,l,l[29],null);return{c(){e=P("button"),s&&s.c(),this.h()},l(i){e=T(i,"BUTTON",{tabindex:!0,"aria-label":!0,"aria-dropeffect":!0,class:!0});var f=L(e);s&&s.l(f),f.forEach(y),this.h()},h(){h(e,"tabindex",t=l[9]?-1:0),h(e,"aria-label",r=l[14]||"Click to upload or drop files"),h(e,"aria-dropeffect","copy"),h(e,"class","svelte-edrmkl"),v(e,"hidden",l[9]),v(e,"center",l[4]),v(e,"boundedheight",l[3]),v(e,"flex",l[5]),v(e,"disable_click",l[7]),v(e,"icon-mode",l[12]),D(e,"height",l[12]?"":l[13]?typeof l[13]=="number"?l[13]+"px":l[13]:"100%")},m(i,f){S(i,e,f),s&&s.m(e,null),u=!0,d||(c=Ce(n=l[18].call(null,e,{on_drag_change:de,on_files:l[31],accepted_types:l[17],mode:l[6],disable_click:l[7]})),d=!0)},p(i,f){s&&s.p&&(!u||f[0]&536870912)&&me(s,a,i,i[29],u?be(a,i[29],f,null):pe(i[29]),null),(!u||f[0]&512&&t!==(t=i[9]?-1:0))&&h(e,"tabindex",t),(!u||f[0]&16384&&r!==(r=i[14]||"Click to upload or drop files"))&&h(e,"aria-label",r),n&&De(n.update)&&f[0]&131264&&n.update.call(null,{on_drag_change:de,on_files:i[31],accepted_types:i[17],mode:i[6],disable_click:i[7]}),(!u||f[0]&512)&&v(e,"hidden",i[9]),(!u||f[0]&16)&&v(e,"center",i[4]),(!u||f[0]&8)&&v(e,"boundedheight",i[3]),(!u||f[0]&32)&&v(e,"flex",i[5]),(!u||f[0]&128)&&v(e,"disable_click",i[7]),(!u||f[0]&4096)&&v(e,"icon-mode",i[12]),f[0]&12288&&D(e,"height",i[12]?"":i[13]?typeof i[13]=="number"?i[13]+"px":i[13]:"100%")},i(i){u||(W(s,i),u=!0)},o(i){N(s,i),u=!1},d(i){i&&y(e),s&&s.d(i),d=!1,c()}}}function Je(l){let e,t,r=!l[9]&&ue(l);return{c(){r&&r.c(),e=q()},l(n){r&&r.l(n),e=q()},m(n,u){r&&r.m(n,u),S(n,e,u),t=!0},p(n,u){n[9]?r&&(ce(),N(r,1,1,()=>{r=null}),he()):r?(r.p(n,u),u[0]&512&&W(r,1)):(r=ue(n),r.c(),W(r,1),r.m(e.parentNode,e))},i(n){t||(W(r),t=!0)},o(n){N(r),t=!1},d(n){n&&y(e),r&&r.d(n)}}}function Ke(l){let e,t,r,n,u,d;const c=l[30].default,a=ge(c,l,l[29],null);return{c(){e=P("button"),a&&a.c(),this.h()},l(s){e=T(s,"BUTTON",{tabindex:!0,"aria-label":!0,class:!0});var i=L(e);a&&a.l(i),i.forEach(y),this.h()},h(){h(e,"tabindex",t=l[9]?-1:0),h(e,"aria-label",r=l[14]||"Paste from clipboard"),h(e,"class","svelte-edrmkl"),v(e,"hidden",l[9]),v(e,"center",l[4]),v(e,"boundedheight",l[3]),v(e,"flex",l[5]),v(e,"icon-mode",l[12]),D(e,"height",l[12]?"":l[13]?typeof l[13]=="number"?l[13]+"px":l[13]:"100%")},m(s,i){S(s,e,i),a&&a.m(e,null),n=!0,u||(d=Ne(e,"click",l[15]),u=!0)},p(s,i){a&&a.p&&(!n||i[0]&536870912)&&me(a,c,s,s[29],n?be(c,s[29],i,null):pe(s[29]),null),(!n||i[0]&512&&t!==(t=s[9]?-1:0))&&h(e,"tabindex",t),(!n||i[0]&16384&&r!==(r=s[14]||"Paste from clipboard"))&&h(e,"aria-label",r),(!n||i[0]&512)&&v(e,"hidden",s[9]),(!n||i[0]&16)&&v(e,"center",s[4]),(!n||i[0]&8)&&v(e,"boundedheight",s[3]),(!n||i[0]&32)&&v(e,"flex",s[5]),(!n||i[0]&4096)&&v(e,"icon-mode",s[12]),i[0]&12288&&D(e,"height",s[12]?"":s[13]?typeof s[13]=="number"?s[13]+"px":s[13]:"100%")},i(s){n||(W(a,s),n=!0)},o(s){N(a,s),n=!1},d(s){s&&y(e),a&&a.d(s),u=!1,d()}}}function ue(l){let e,t;return e=new Ge({props:{root:l[8],upload_id:l[19],files:l[16],stream_handler:l[11]}}),{c(){Se(e.$$.fragment)},l(r){ze(e.$$.fragment,r)},m(r,n){Oe(e,r,n),t=!0},p(r,n){const u={};n[0]&256&&(u.root=r[8]),n[0]&65536&&(u.files=r[16]),n[0]&2048&&(u.stream_handler=r[11]),e.$set(u)},i(r){t||(W(e.$$.fragment,r),t=!0)},o(r){N(e.$$.fragment,r),t=!1},d(r){Fe(e,r)}}}function Qe(l){let e,t,r,n;const u=[Ke,Je,He],d=[];function c(a,s){return a[0]==="clipboard"?0:a[2]&&a[10]?1:2}return e=c(l),t=d[e]=u[e](l),{c(){t.c(),r=q()},l(a){t.l(a),r=q()},m(a,s){d[e].m(a,s),S(a,r,s),n=!0},p(a,s){let i=e;e=c(a),e===i?d[e].p(a,s):(ce(),N(d[i],1,1,()=>{d[i]=null}),he(),t=d[e],t?t.p(a,s):(t=d[e]=u[e](a),t.c()),W(t,1),t.m(r.parentNode,r))},i(a){n||(W(t),n=!0)},o(a){N(t),n=!1},d(a){a&&y(r),d[e].d(a)}}}function Xe(l,e,t){if(!l||l==="*"||l==="file/*"||Array.isArray(l)&&l.some(n=>n==="*"||n==="file/*"))return!0;let r;if(typeof l=="string")r=l.split(",").map(n=>n.trim());else if(Array.isArray(l))r=l;else return!1;return r.includes(e)||r.some(n=>{const[u]=n.split("/").map(d=>d.trim());return n.endsWith("/*")&&t.startsWith(u+"/")})}const de=l=>l=l;function Ye(l,e,t){let r,{$$slots:n={},$$scope:u}=e;const{drag:d,open_file_upload:c}=qe();let{filetype:a=null}=e,{dragging:s=!1}=e,{boundedheight:i=!0}=e,{center:f=!0}=e,{flex:_=!0}=e,{file_count:g="single"}=e,{disable_click:m=!1}=e,{root:E}=e,{hidden:A=!1}=e,{format:C="file"}=e,{uploading:I=!1}=e,{show_progress:te=!0}=e,{max_file_size:H=null}=e,{upload:J}=e,{stream_handler:le}=e,{icon_upload:ne=!1}=e,{height:re=void 0}=e,{aria_label:ie=void 0}=e;function ve(){c()}let ye,K,z,ae=null;const ke=()=>{if(typeof navigator<"u"){const o=navigator.userAgent.toLowerCase();return o.indexOf("iphone")>-1||o.indexOf("ipad")>-1}return!1},U=_e(),we=["image","video","audio","text","file"],Q=o=>r&&o.startsWith(".")?(ae=!0,o):r&&o.includes("file/*")?"*":o.startsWith(".")||o.endsWith("/*")?o:we.includes(o)?o+"/*":"."+o;function Ee(){navigator.clipboard.read().then(async o=>{for(let k=0;k<o.length;k++){const p=o[k].types.find(b=>b.startsWith("image/"));if(p){o[k].getType(p).then(async b=>{const X=new File([b],`clipboard.${p.replace("image/","")}`);await M([X])});break}}})}function Le(){c()}async function Ae(o,k){await Ie(),k||(k=Math.random().toString(36).substring(2,15)),t(2,I=!0);try{const p=await J(o,E,k,H??1/0);return U("load",g==="single"?p==null?void 0:p[0]:p),t(2,I=!1),p||[]}catch(p){return U("error",p.message),t(2,I=!1),[]}}async function M(o,k){if(!o.length)return;let p=o.map(b=>new File([b],b instanceof File?b.name:"file",{type:b.type}));return r&&ae&&(p=p.filter(b=>oe(b)?!0:(U("error",`Invalid file type: ${b.name}. Only ${a} allowed.`),!1)),p.length===0)?[]:(t(16,K=await je(p)),await Ae(K,k))}function oe(o){return a?(Array.isArray(a)?a:[a]).some(p=>{const b=Q(p);if(b.startsWith("."))return o.name.toLowerCase().endsWith(b.toLowerCase());if(b==="*")return!0;if(b.endsWith("/*")){const[X]=b.split("/");return o.type.startsWith(X+"/")}return o.type===b}):!0}async function se(o){const k=o.filter(p=>{const b="."+p.name.toLowerCase().split(".").pop();return b&&Xe(z,b,p.type)||(b&&Array.isArray(a)?a.includes(b):b===a)?!0:(U("error",`Invalid file type only ${a} allowed.`),!1)});if(C!="blob")await M(k);else{if(g==="single"){U("load",k[0]);return}U("load",k)}}async function Pe(o){var p;if(t(1,s=!1),!((p=o.dataTransfer)!=null&&p.files))return;const k=Array.from(o.dataTransfer.files).filter(oe);if(C!="blob")await M(k);else{if(g==="single"){U("load",k[0]);return}U("load",k)}}const Te=o=>se(o);return l.$$set=o=>{"filetype"in o&&t(0,a=o.filetype),"dragging"in o&&t(1,s=o.dragging),"boundedheight"in o&&t(3,i=o.boundedheight),"center"in o&&t(4,f=o.center),"flex"in o&&t(5,_=o.flex),"file_count"in o&&t(6,g=o.file_count),"disable_click"in o&&t(7,m=o.disable_click),"root"in o&&t(8,E=o.root),"hidden"in o&&t(9,A=o.hidden),"format"in o&&t(21,C=o.format),"uploading"in o&&t(2,I=o.uploading),"show_progress"in o&&t(10,te=o.show_progress),"max_file_size"in o&&t(22,H=o.max_file_size),"upload"in o&&t(23,J=o.upload),"stream_handler"in o&&t(11,le=o.stream_handler),"icon_upload"in o&&t(12,ne=o.icon_upload),"height"in o&&t(13,re=o.height),"aria_label"in o&&t(14,ie=o.aria_label),"$$scope"in o&&t(29,u=o.$$scope)},l.$$.update=()=>{l.$$.dirty[0]&268435457&&(a==null?t(17,z=null):typeof a=="string"?t(17,z=Q(a)):r&&a.includes("file/*")?t(17,z="*"):(t(0,a=a.map(Q)),t(17,z=a.join(", "))))},t(28,r=ke()),[a,s,I,i,f,_,g,m,E,A,te,le,ne,re,ie,Ee,K,z,d,ye,se,C,H,J,ve,Le,M,Pe,r,u,n,Te]}class nt extends x{constructor(e){super(),$(this,e,Ye,Qe,ee,{filetype:0,dragging:1,boundedheight:3,center:4,flex:5,file_count:6,disable_click:7,root:8,hidden:9,format:21,uploading:2,show_progress:10,max_file_size:22,upload:23,stream_handler:11,icon_upload:12,height:13,aria_label:14,open_upload:24,paste_clipboard:15,open_file_upload:25,load_files:26,load_files_from_drop:27},null,[-1,-1])}get open_upload(){return this.$$.ctx[24]}get paste_clipboard(){return this.$$.ctx[15]}get open_file_upload(){return this.$$.ctx[25]}get load_files(){return this.$$.ctx[26]}get load_files_from_drop(){return this.$$.ctx[27]}}export{tt as U,nt as a,Ge as b,qe as c};
//# sourceMappingURL=Upload.CX1VDyJc.js.map
