import{SvelteComponent as we,init as ke,safe_not_equal as Ie,svg_element as ge,claim_svg_element as he,children as B,detach as b,attr as g,insert_hydration as V,append_hydration as z,noop as x,element as N,create_component as j,space as F,text as ue,claim_element as U,claim_component as P,claim_space as A,claim_text as ce,set_style as be,mount_component as R,listen as ae,transition_in as w,transition_out as E,destroy_component as q,createEventDispatcher as Oe,toggle_class as $,src_url_equal as We,group_outros as ee,check_outros as te,onMount as lt,onDestroy as it,binding_callbacks as oe,empty as le,add_render_callback as nt,create_in_transition as rt,stop_propagation as at,action_destroyer as ot,run_all as Ke,ensure_array_like as je,destroy_each as st,set_input_value as Me,set_data as Ee,bind as pe,add_flush_callback as ve,tick as ye,bubble as me,create_slot as ut,update_slot_base as ct,get_all_dirty_from_scope as ft,get_slot_changes as _t}from"../../../svelte/svelte.js";import{fade as dt}from"../../../svelte/svelte-submodules.js";import{G as mt,P as gt,I as ht,U as bt,j as pt,C as vt,q as wt}from"./2.CDVdg6R9.js";import{B as kt}from"./BlockLabel.B95-RZnt.js";import{I as It}from"./Image.CTVzPhL7.js";import{W as Et,a as yt,S as Dt}from"./SelectSource.gyAj2Qlo.js";import{F as zt}from"./FullscreenButton.D9CSQ4Gg.js";import{g as Tt}from"./utils.Gtzs_Zla.js";import{D as Qe}from"./DropdownArrow.DDlaKXES.js";import{S as Bt}from"./StreamingBar.gCAzTUNq.js";import{a as Vt,b as Nt}from"./Upload.CX1VDyJc.js";function Ut(n){let e,t,l;return{c(){e=ge("svg"),t=ge("path"),l=ge("circle"),this.h()},l(i){e=he(i,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var r=B(e);t=he(r,"path",{d:!0}),B(t).forEach(b),l=he(r,"circle",{cx:!0,cy:!0,r:!0}),B(l).forEach(b),r.forEach(b),this.h()},h(){g(t,"d","M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"),g(l,"cx","12"),g(l,"cy","13"),g(l,"r","4"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"width","100%"),g(e,"height","100%"),g(e,"viewBox","0 0 24 24"),g(e,"fill","none"),g(e,"stroke","currentColor"),g(e,"stroke-width","1.5"),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"class","feather feather-camera")},m(i,r){V(i,e,r),z(e,t),z(e,l)},p:x,i:x,o:x,d(i){i&&b(e)}}}class Ct extends we{constructor(e){super(),ke(this,e,null,Ut,Ie,{})}}function Mt(n){let e,t;return{c(){e=ge("svg"),t=ge("circle"),this.h()},l(l){e=he(l,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0,class:!0});var i=B(e);t=he(i,"circle",{cx:!0,cy:!0,r:!0}),B(t).forEach(b),i.forEach(b),this.h()},h(){g(t,"cx","12"),g(t,"cy","12"),g(t,"r","10"),g(e,"xmlns","http://www.w3.org/2000/svg"),g(e,"width","100%"),g(e,"height","100%"),g(e,"viewBox","0 0 24 24"),g(e,"stroke-width","1.5"),g(e,"stroke-linecap","round"),g(e,"stroke-linejoin","round"),g(e,"class","feather feather-circle")},m(l,i){V(l,e,i),z(e,t)},p:x,i:x,o:x,d(l){l&&b(e)}}}class Ot extends we{constructor(e){super(),ke(this,e,null,Mt,Ie,{})}}function St(n){let e,t,l,i,r,a="Click to Access Webcam",s,o,c,f;return i=new Et({}),{c(){e=N("button"),t=N("div"),l=N("span"),j(i.$$.fragment),r=F(),s=ue(a),this.h()},l(d){e=U(d,"BUTTON",{class:!0});var k=B(e);t=U(k,"DIV",{class:!0});var y=B(t);l=U(y,"SPAN",{class:!0});var O=B(l);P(i.$$.fragment,O),O.forEach(b),r=A(y),s=ce(y,a),y.forEach(b),k.forEach(b),this.h()},h(){g(l,"class","icon-wrap svelte-qbrfs"),g(t,"class","wrap svelte-qbrfs"),g(e,"class","svelte-qbrfs"),be(e,"height","100%")},m(d,k){V(d,e,k),z(e,t),z(t,l),R(i,l,null),z(t,r),z(t,s),o=!0,c||(f=ae(e,"click",n[1]),c=!0)},p:x,i(d){o||(w(i.$$.fragment,d),o=!0)},o(d){E(i.$$.fragment,d),o=!1},d(d){d&&b(e),q(i),c=!1,f()}}}function Wt(n){const e=Oe();return[e,()=>e("click")]}class jt extends we{constructor(e){super(),ke(this,e,Wt,St,Ie,{})}}function Pt(){return navigator.mediaDevices.enumerateDevices()}function Rt(n,e){e.srcObject=n,e.muted=!0,e.play()}async function Pe(n,e,t,l){const i={video:l?{deviceId:{exact:l},...t==null?void 0:t.video}:(t==null?void 0:t.video)||{width:{ideal:1920},height:{ideal:1440}},audio:n&&((t==null?void 0:t.audio)??!0)};return navigator.mediaDevices.getUserMedia(i).then(r=>(Rt(r,e),r))}function qt(n){return n.filter(t=>t.kind==="videoinput")}function Re(n,e,t){const l=n.slice();return l[39]=e[t],l}function Lt(n){let e,t,l,i,r,a,s,o,c,f,d;const k=[Ht,At],y=[];function O(I,D){return I[2]==="video"||I[1]?0:1}l=O(n),i=y[l]=k[l](n);let m=!n[11]&&qe(n),p=n[13]&&n[8]&&Le(n);return{c(){e=N("div"),t=N("button"),i.c(),a=F(),m&&m.c(),s=F(),p&&p.c(),o=le(),this.h()},l(I){e=U(I,"DIV",{class:!0});var D=B(e);t=U(D,"BUTTON",{"aria-label":!0,class:!0});var S=B(t);i.l(S),S.forEach(b),a=A(D),m&&m.l(D),D.forEach(b),s=A(I),p&&p.l(I),o=le(),this.h()},h(){g(t,"aria-label",r=n[2]==="image"?"capture photo":"start recording"),g(t,"class","svelte-10cpz3p"),g(e,"class","button-wrap svelte-10cpz3p")},m(I,D){V(I,e,D),z(e,t),y[l].m(t,null),z(e,a),m&&m.m(e,null),V(I,s,D),p&&p.m(I,D),V(I,o,D),c=!0,f||(d=ae(t,"click",n[28]),f=!0)},p(I,D){let S=l;l=O(I),l===S?y[l].p(I,D):(ee(),E(y[S],1,1,()=>{y[S]=null}),te(),i=y[l],i?i.p(I,D):(i=y[l]=k[l](I),i.c()),w(i,1),i.m(t,null)),(!c||D[0]&4&&r!==(r=I[2]==="image"?"capture photo":"start recording"))&&g(t,"aria-label",r),I[11]?m&&(ee(),E(m,1,1,()=>{m=null}),te()):m?(m.p(I,D),D[0]&2048&&w(m,1)):(m=qe(I),m.c(),w(m,1),m.m(e,null)),I[13]&&I[8]?p?(p.p(I,D),D[0]&8448&&w(p,1)):(p=Le(I),p.c(),w(p,1),p.m(o.parentNode,o)):p&&(ee(),E(p,1,1,()=>{p=null}),te())},i(I){c||(w(i),w(m),w(p),c=!0)},o(I){E(i),E(m),E(p),c=!1},d(I){I&&(b(e),b(s),b(o)),y[l].d(),m&&m.d(),p&&p.d(I),f=!1,d()}}}function Ft(n){let e,t,l,i;return t=new jt({}),t.$on("click",n[27]),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(r){e=U(r,"DIV",{title:!0,style:!0});var a=B(e);P(t.$$.fragment,a),a.forEach(b),this.h()},h(){g(e,"title","grant webcam access"),be(e,"height","100%")},m(r,a){V(r,e,a),R(t,e,null),i=!0},p:x,i(r){i||(w(t.$$.fragment,r),r&&(l||nt(()=>{l=rt(e,dt,{delay:100,duration:200}),l.start()})),i=!0)},o(r){E(t.$$.fragment,r),i=!1},d(r){r&&b(e),q(t)}}}function At(n){let e,t,l;return t=new Ct({}),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(i){e=U(i,"DIV",{class:!0,title:!0});var r=B(e);P(t.$$.fragment,r),r.forEach(b),this.h()},h(){g(e,"class","icon svelte-10cpz3p"),g(e,"title","capture photo")},m(i,r){V(i,e,r),R(t,e,null),l=!0},p:x,i(i){l||(w(t.$$.fragment,i),l=!0)},o(i){E(t.$$.fragment,i),l=!1},d(i){i&&b(e),q(t)}}}function Ht(n){let e,t,l,i;const r=[Kt,Jt,Gt],a=[];function s(o,c){return o[1]&&o[10]==="waiting"?0:o[1]&&o[10]==="open"||!o[1]&&o[11]?1:2}return e=s(n),t=a[e]=r[e](n),{c(){t.c(),l=le()},l(o){t.l(o),l=le()},m(o,c){a[e].m(o,c),V(o,l,c),i=!0},p(o,c){let f=e;e=s(o),e===f?a[e].p(o,c):(ee(),E(a[f],1,1,()=>{a[f]=null}),te(),t=a[e],t?t.p(o,c):(t=a[e]=r[e](o),t.c()),w(t,1),t.m(l.parentNode,l))},i(o){i||(w(t),i=!0)},o(o){E(t),i=!1},d(o){o&&b(l),a[e].d(o)}}}function Gt(n){let e,t,l,i,r=n[4]("audio.record")+"",a,s;return l=new Ot({}),{c(){e=N("div"),t=N("div"),j(l.$$.fragment),i=F(),a=ue(r),this.h()},l(o){e=U(o,"DIV",{class:!0});var c=B(e);t=U(c,"DIV",{class:!0,title:!0});var f=B(t);P(l.$$.fragment,f),f.forEach(b),i=A(c),a=ce(c,r),c.forEach(b),this.h()},h(){g(t,"class","icon color-primary svelte-10cpz3p"),g(t,"title","start recording"),g(e,"class","icon-with-text svelte-10cpz3p")},m(o,c){V(o,e,c),z(e,t),R(l,t,null),z(e,i),z(e,a),s=!0},p(o,c){(!s||c[0]&16)&&r!==(r=o[4]("audio.record")+"")&&Ee(a,r)},i(o){s||(w(l.$$.fragment,o),s=!0)},o(o){E(l.$$.fragment,o),s=!1},d(o){o&&b(e),q(l)}}}function Jt(n){let e,t,l,i,r=n[4]("audio.stop")+"",a,s;return l=new gt({}),{c(){e=N("div"),t=N("div"),j(l.$$.fragment),i=F(),a=ue(r),this.h()},l(o){e=U(o,"DIV",{class:!0});var c=B(e);t=U(c,"DIV",{class:!0,title:!0});var f=B(t);P(l.$$.fragment,f),f.forEach(b),i=A(c),a=ce(c,r),c.forEach(b),this.h()},h(){g(t,"class","icon color-primary svelte-10cpz3p"),g(t,"title","stop recording"),g(e,"class","icon-with-text svelte-10cpz3p")},m(o,c){V(o,e,c),z(e,t),R(l,t,null),z(e,i),z(e,a),s=!0},p(o,c){(!s||c[0]&16)&&r!==(r=o[4]("audio.stop")+"")&&Ee(a,r)},i(o){s||(w(l.$$.fragment,o),s=!0)},o(o){E(l.$$.fragment,o),s=!1},d(o){o&&b(e),q(l)}}}function Kt(n){let e,t,l,i,r=n[4]("audio.waiting")+"",a,s;return l=new yt({}),{c(){e=N("div"),t=N("div"),j(l.$$.fragment),i=F(),a=ue(r),this.h()},l(o){e=U(o,"DIV",{class:!0,style:!0});var c=B(e);t=U(c,"DIV",{class:!0,title:!0});var f=B(t);P(l.$$.fragment,f),f.forEach(b),i=A(c),a=ce(c,r),c.forEach(b),this.h()},h(){g(t,"class","icon color-primary svelte-10cpz3p"),g(t,"title","spinner"),g(e,"class","icon-with-text svelte-10cpz3p"),be(e,"width","var(--size-24)")},m(o,c){V(o,e,c),z(e,t),R(l,t,null),z(e,i),z(e,a),s=!0},p(o,c){(!s||c[0]&16)&&r!==(r=o[4]("audio.waiting")+"")&&Ee(a,r)},i(o){s||(w(l.$$.fragment,o),s=!0)},o(o){E(l.$$.fragment,o),s=!1},d(o){o&&b(e),q(l)}}}function qe(n){let e,t,l,i,r;return t=new Qe({}),{c(){e=N("button"),j(t.$$.fragment),this.h()},l(a){e=U(a,"BUTTON",{class:!0,"aria-label":!0});var s=B(e);P(t.$$.fragment,s),s.forEach(b),this.h()},h(){g(e,"class","icon svelte-10cpz3p"),g(e,"aria-label","select input source")},m(a,s){V(a,e,s),R(t,e,null),l=!0,i||(r=ae(e,"click",n[29]),i=!0)},p:x,i(a){l||(w(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&b(e),q(t),i=!1,r()}}}function Le(n){let e,t,l,i,r,a,s;l=new Qe({});function o(d,k){return d[7].length===0?Xt:Qt}let c=o(n),f=c(n);return{c(){e=N("select"),t=N("button"),j(l.$$.fragment),i=F(),f.c(),this.h()},l(d){e=U(d,"SELECT",{class:!0,"aria-label":!0});var k=B(e);t=U(k,"BUTTON",{class:!0});var y=B(t);P(l.$$.fragment,y),i=A(y),y.forEach(b),f.l(k),k.forEach(b),this.h()},h(){g(t,"class","inset-icon svelte-10cpz3p"),g(e,"class","select-wrap svelte-10cpz3p"),g(e,"aria-label","select source")},m(d,k){V(d,e,k),z(e,t),R(l,t,null),z(t,i),f.m(e,null),r=!0,a||(s=[ae(t,"click",at(n[30])),ot(Se.call(null,e,n[17])),ae(e,"change",n[14])],a=!0)},p(d,k){c===(c=o(d))&&f?f.p(d,k):(f.d(1),f=c(d),f&&(f.c(),f.m(e,null)))},i(d){r||(w(l.$$.fragment,d),r=!0)},o(d){E(l.$$.fragment,d),r=!1},d(d){d&&b(e),q(l),f.d(),a=!1,Ke(s)}}}function Qt(n){let e,t=je(n[7]),l=[];for(let i=0;i<t.length;i+=1)l[i]=Fe(Re(n,t,i));return{c(){for(let i=0;i<l.length;i+=1)l[i].c();e=le()},l(i){for(let r=0;r<l.length;r+=1)l[r].l(i);e=le()},m(i,r){for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(i,r);V(i,e,r)},p(i,r){if(r[0]&384){t=je(i[7]);let a;for(a=0;a<t.length;a+=1){const s=Re(i,t,a);l[a]?l[a].p(s,r):(l[a]=Fe(s),l[a].c(),l[a].m(e.parentNode,e))}for(;a<l.length;a+=1)l[a].d(1);l.length=t.length}},d(i){i&&b(e),st(l,i)}}}function Xt(n){let e,t=n[4]("common.no_devices")+"",l;return{c(){e=N("option"),l=ue(t),this.h()},l(i){e=U(i,"OPTION",{class:!0});var r=B(e);l=ce(r,t),r.forEach(b),this.h()},h(){e.__value="",Me(e,e.__value),g(e,"class","svelte-10cpz3p")},m(i,r){V(i,e,r),z(e,l)},p(i,r){r[0]&16&&t!==(t=i[4]("common.no_devices")+"")&&Ee(l,t)},d(i){i&&b(e)}}}function Fe(n){let e,t=n[39].label+"",l,i,r,a;return{c(){e=N("option"),l=ue(t),i=F(),this.h()},l(s){e=U(s,"OPTION",{class:!0});var o=B(e);l=ce(o,t),i=A(o),o.forEach(b),this.h()},h(){e.__value=r=n[39].deviceId,Me(e,e.__value),e.selected=a=n[8].deviceId===n[39].deviceId,g(e,"class","svelte-10cpz3p")},m(s,o){V(s,e,o),z(e,l),z(e,i)},p(s,o){o[0]&128&&t!==(t=s[39].label+"")&&Ee(l,t),o[0]&128&&r!==(r=s[39].deviceId)&&(e.__value=r,Me(e,e.__value)),o[0]&384&&a!==(a=s[8].deviceId===s[39].deviceId)&&(e.selected=a)},d(s){s&&b(e)}}}function Yt(n){let e,t,l,i,r,a,s,o,c,f,d;t=new Bt({props:{time_limit:n[9]}});const k=[Ft,Lt],y=[];function O(m,p){return m[12]?1:0}return c=O(n),f=y[c]=k[c](n),{c(){e=N("div"),j(t.$$.fragment),l=F(),i=N("video"),r=F(),a=N("img"),o=F(),f.c(),this.h()},l(m){e=U(m,"DIV",{class:!0});var p=B(e);P(t.$$.fragment,p),l=A(p),i=U(p,"VIDEO",{class:!0}),B(i).forEach(b),r=A(p),a=U(p,"IMG",{src:!0,class:!0}),o=A(p),f.l(p),p.forEach(b),this.h()},h(){var m;g(i,"class","svelte-10cpz3p"),$(i,"flip",n[3]),$(i,"hide",!n[12]||n[12]&&!!n[0]),We(a.src,s=(m=n[0])==null?void 0:m.url)||g(a,"src",s),g(a,"class","svelte-10cpz3p"),$(a,"hide",!n[12]||n[12]&&!n[0]),g(e,"class","wrap svelte-10cpz3p")},m(m,p){V(m,e,p),R(t,e,null),z(e,l),z(e,i),n[26](i),z(e,r),z(e,a),z(e,o),y[c].m(e,null),d=!0},p(m,p){var S;const I={};p[0]&512&&(I.time_limit=m[9]),t.$set(I),(!d||p[0]&8)&&$(i,"flip",m[3]),(!d||p[0]&4097)&&$(i,"hide",!m[12]||m[12]&&!!m[0]),(!d||p[0]&1&&!We(a.src,s=(S=m[0])==null?void 0:S.url))&&g(a,"src",s),(!d||p[0]&4097)&&$(a,"hide",!m[12]||m[12]&&!m[0]);let D=c;c=O(m),c===D?y[c].p(m,p):(ee(),E(y[D],1,1,()=>{y[D]=null}),te(),f=y[c],f?f.p(m,p):(f=y[c]=k[c](m),f.c()),w(f,1),f.m(e,null))},i(m){d||(w(t.$$.fragment,m),w(f),d=!0)},o(m){E(t.$$.fragment,m),E(f),d=!1},d(m){m&&b(e),q(t),n[26](null),y[c].d()}}}function Se(n,e){const t=l=>{n&&!n.contains(l.target)&&!l.defaultPrevented&&e(l)};return document.addEventListener("click",t,!0),{destroy(){document.removeEventListener("click",t,!0)}}}function Zt(n,e,t){let l,i=[],r=null,a=null,s="closed";const o=h=>{h==="closed"?(t(9,a=null),t(10,s="closed"),t(0,G=null)):h==="waiting"?t(10,s="waiting"):t(10,s="open")},c=h=>{v&&t(9,a=h)};let f,{streaming:d=!1}=e,{pending:k=!1}=e,{root:y=""}=e,{stream_every:O=1}=e,{mode:m="image"}=e,{mirror_webcam:p}=e,{include_audio:I}=e,{webcam_constraints:D=null}=e,{i18n:S}=e,{upload:K}=e,{value:G=null}=e;const C=Oe();lt(()=>{f=document.createElement("canvas"),d&&m==="image"&&window.setInterval(()=>{l&&!k&&_()},O*1e3)});const X=async h=>{const Z=h.target.value;await Pe(I,l,D,Z).then(async ie=>{L=ie,t(8,r=i.find(_e=>_e.deviceId===Z)||null),t(13,J=!1)})};async function T(){try{Pe(I,l,D).then(async h=>{t(12,re=!0),t(7,i=await Pt()),L=h}).then(()=>qt(i)).then(h=>{t(7,i=h);const W=L.getTracks().map(Z=>{var ie;return(ie=Z.getSettings())==null?void 0:ie.deviceId})[0];t(8,r=W&&h.find(Z=>Z.deviceId===W)||i[0])}),(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)&&C("error",S("image.no_webcam_support"))}catch(h){if(h instanceof DOMException&&h.name=="NotAllowedError")C("error",S("image.allow_webcam_access"));else throw h}}function _(){var h=f.getContext("2d");if((!d||d&&v)&&l.videoWidth&&l.videoHeight){if(f.width=l.videoWidth,f.height=l.videoHeight,h.drawImage(l,0,0,l.videoWidth,l.videoHeight),p&&(h.scale(-1,1),h.drawImage(l,-l.videoWidth,0)),d&&(!v||s==="waiting"))return;if(d){const W=f.toDataURL("image/jpeg");C("stream",W);return}f.toBlob(W=>{C(d?"stream":"capture",W)},`image/${d?"jpeg":"png"}`,.8)}}let v=!1,H=[],L,M,Q;function De(){if(v){Q.stop();let h=new Blob(H,{type:M}),W=new FileReader;W.onload=async function(Z){var ie;if(Z.target){let _e=new File([h],"sample."+M.substring(6));const Ue=await mt([_e]);let Ce=(ie=await K(Ue,y))==null?void 0:ie.filter(Boolean)[0];C("capture",Ce),C("stop_recording")}},W.readAsDataURL(h)}else if(typeof MediaRecorder<"u"){C("start_recording"),H=[];let h=["video/webm","video/mp4"];for(let W of h)if(MediaRecorder.isTypeSupported(W)){M=W;break}if(M===null){console.error("No supported MediaRecorder mimeType");return}Q=new MediaRecorder(L,{mimeType:M}),Q.addEventListener("dataavailable",function(W){H.push(W.data)}),Q.start(200)}t(11,v=!v)}let re=!1;function Y({destroy:h}={}){m==="image"&&d&&t(11,v=!v),h||(m==="image"?_():De()),!v&&L&&(C("close_stream"),L.getTracks().forEach(W=>W.stop()),t(6,l.srcObject=null,l),t(12,re=!1),window.setTimeout(()=>{t(0,G=null)},500),t(0,G=null))}let J=!1;function ze(h){h.preventDefault(),h.stopPropagation(),t(13,J=!1)}it(()=>{typeof window>"u"||(Y({destroy:!0}),L==null||L.getTracks().forEach(h=>h.stop()))});function Te(h){oe[h?"unshift":"push"](()=>{l=h,t(6,l)})}const fe=async()=>T(),Be=()=>Y(),Ve=()=>t(13,J=!0),Ne=()=>t(13,J=!1);return n.$$set=h=>{"streaming"in h&&t(1,d=h.streaming),"pending"in h&&t(20,k=h.pending),"root"in h&&t(21,y=h.root),"stream_every"in h&&t(22,O=h.stream_every),"mode"in h&&t(2,m=h.mode),"mirror_webcam"in h&&t(3,p=h.mirror_webcam),"include_audio"in h&&t(23,I=h.include_audio),"webcam_constraints"in h&&t(24,D=h.webcam_constraints),"i18n"in h&&t(4,S=h.i18n),"upload"in h&&t(25,K=h.upload),"value"in h&&t(0,G=h.value)},[G,d,m,p,S,Se,l,i,r,a,s,v,re,J,X,T,Y,ze,o,c,k,y,O,I,D,K,Te,fe,Be,Ve,Ne]}class $t extends we{constructor(e){super(),ke(this,e,Zt,Yt,Ie,{modify_stream:18,set_time_limit:19,streaming:1,pending:20,root:21,stream_every:22,mode:2,mirror_webcam:3,include_audio:23,webcam_constraints:24,i18n:4,upload:25,value:0,click_outside:5},null,[-1,-1])}get modify_stream(){return this.$$.ctx[18]}get set_time_limit(){return this.$$.ctx[19]}get click_outside(){return Se}}const xt=$t;function Ae(n){let e,t,l,i=n[19]&&He(n);return t=new pt({props:{Icon:vt,label:"Remove Image"}}),t.$on("click",n[28]),{c(){i&&i.c(),e=F(),j(t.$$.fragment)},l(r){i&&i.l(r),e=A(r),P(t.$$.fragment,r)},m(r,a){i&&i.m(r,a),V(r,e,a),R(t,r,a),l=!0},p(r,a){r[19]?i?(i.p(r,a),a[0]&524288&&w(i,1)):(i=He(r),i.c(),w(i,1),i.m(e.parentNode,e)):i&&(ee(),E(i,1,1,()=>{i=null}),te())},i(r){l||(w(i),w(t.$$.fragment,r),l=!0)},o(r){E(i),E(t.$$.fragment,r),l=!1},d(r){r&&b(e),i&&i.d(r),q(t,r)}}}function He(n){let e,t;return e=new zt({props:{fullscreen:n[20]}}),e.$on("fullscreen",n[35]),{c(){j(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,i){R(e,l,i),t=!0},p(l,i){const r={};i[0]&1048576&&(r.fullscreen=l[20]),e.$set(r)},i(l){t||(w(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){q(e,l)}}}function el(n){var i;let e,t,l=((i=n[3])==null?void 0:i.url)&&!n[21]&&Ae(n);return{c(){l&&l.c(),e=le()},l(r){l&&l.l(r),e=le()},m(r,a){l&&l.m(r,a),V(r,e,a),t=!0},p(r,a){var s;(s=r[3])!=null&&s.url&&!r[21]?l?(l.p(r,a),a[0]&2097160&&w(l,1)):(l=Ae(r),l.c(),w(l,1),l.m(e.parentNode,e)):l&&(ee(),E(l,1,1,()=>{l=null}),te())},i(r){t||(w(l),t=!0)},o(r){E(l),t=!1},d(r){r&&b(e),l&&l.d(r)}}}function Ge(n){let e;const t=n[34].default,l=ut(t,n,n[50],null);return{c(){l&&l.c()},l(i){l&&l.l(i)},m(i,r){l&&l.m(i,r),e=!0},p(i,r){l&&l.p&&(!e||r[1]&524288)&&ct(l,t,i,i[50],e?_t(t,i[50],r,null):ft(i[50]),null)},i(i){e||(w(l,i),e=!0)},o(i){E(l,i),e=!1},d(i){l&&l.d(i)}}}function tl(n){let e,t,l=n[3]===null&&Ge(n);return{c(){l&&l.c(),e=le()},l(i){l&&l.l(i),e=le()},m(i,r){l&&l.m(i,r),V(i,e,r),t=!0},p(i,r){i[3]===null?l?(l.p(i,r),r[0]&8&&w(l,1)):(l=Ge(i),l.c(),w(l,1),l.m(e.parentNode,e)):l&&(ee(),E(l,1,1,()=>{l=null}),te())},i(i){t||(w(l),t=!0)},o(i){E(l),t=!1},d(i){i&&b(e),l&&l.d(i)}}}function ll(n){let e,t,l,i,r;return t=new wt({props:{src:n[3].url,alt:n[3].alt_text}}),{c(){e=N("div"),j(t.$$.fragment),this.h()},l(a){e=U(a,"DIV",{class:!0});var s=B(e);P(t.$$.fragment,s),s.forEach(b),this.h()},h(){g(e,"class","image-frame svelte-1hdlew6"),$(e,"selectable",n[12])},m(a,s){V(a,e,s),R(t,e,null),l=!0,i||(r=ae(e,"click",n[30]),i=!0)},p(a,s){const o={};s[0]&8&&(o.src=a[3].url),s[0]&8&&(o.alt=a[3].alt_text),t.$set(o),(!l||s[0]&4096)&&$(e,"selectable",a[12])},i(a){l||(w(t.$$.fragment,a),l=!0)},o(a){E(t.$$.fragment,a),l=!1},d(a){a&&b(e),q(t),i=!1,r()}}}function il(n){let e,t,l,i;function r(o){n[40](o)}function a(o){n[41](o)}let s={root:n[13],value:n[3],mirror_webcam:n[11].mirror,stream_every:n[18],streaming:n[10],mode:"image",include_audio:!1,i18n:n[14],upload:n[16],webcam_constraints:n[11].constraints};return n[5]!==void 0&&(s.modify_stream=n[5]),n[6]!==void 0&&(s.set_time_limit=n[6]),e=new xt({props:s}),oe.push(()=>pe(e,"modify_stream",r)),oe.push(()=>pe(e,"set_time_limit",a)),e.$on("capture",n[42]),e.$on("stream",n[43]),e.$on("error",n[44]),e.$on("drag",n[45]),e.$on("upload",n[46]),e.$on("close_stream",n[47]),{c(){j(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,c){R(e,o,c),i=!0},p(o,c){const f={};c[0]&8192&&(f.root=o[13]),c[0]&8&&(f.value=o[3]),c[0]&2048&&(f.mirror_webcam=o[11].mirror),c[0]&262144&&(f.stream_every=o[18]),c[0]&1024&&(f.streaming=o[10]),c[0]&16384&&(f.i18n=o[14]),c[0]&65536&&(f.upload=o[16]),c[0]&2048&&(f.webcam_constraints=o[11].constraints),!t&&c[0]&32&&(t=!0,f.modify_stream=o[5],ve(()=>t=!1)),!l&&c[0]&64&&(l=!0,f.set_time_limit=o[6],ve(()=>l=!1)),e.$set(f)},i(o){i||(w(e.$$.fragment,o),i=!0)},o(o){E(e.$$.fragment,o),i=!1},d(o){q(e,o)}}}function nl(n){let e,t;return e=new Nt({props:{root:n[13],upload_id:n[24],stream_handler:n[17],files:n[23]}}),{c(){j(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,i){R(e,l,i),t=!0},p(l,i){const r={};i[0]&8192&&(r.root=l[13]),i[0]&16777216&&(r.upload_id=l[24]),i[0]&131072&&(r.stream_handler=l[17]),i[0]&8388608&&(r.files=l[23]),e.$set(r)},i(l){t||(w(e.$$.fragment,l),t=!0)},o(l){E(e.$$.fragment,l),t=!1},d(l){q(e,l)}}}function Je(n){let e,t,l;function i(a){n[48](a)}let r={sources:n[9],handle_clear:n[27],handle_select:n[31]};return n[1]!==void 0&&(r.active_source=n[1]),e=new Dt({props:r}),oe.push(()=>pe(e,"active_source",i)),{c(){j(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,s){R(e,a,s),l=!0},p(a,s){const o={};s[0]&512&&(o.sources=a[9]),!t&&s[0]&2&&(t=!0,o.active_source=a[1],ve(()=>t=!1)),e.$set(o)},i(a){l||(w(e.$$.fragment,a),l=!0)},o(a){E(e.$$.fragment,a),l=!1},d(a){q(e,a)}}}function rl(n){let e,t,l,i,r,a,s,o,c,f,d,k,y,O=n[9].length>1||n[9].includes("clipboard"),m,p,I;e=new kt({props:{show_label:n[8],Icon:It,label:n[7]||"Image"}}),i=new ht({props:{$$slots:{default:[el]},$$scope:{ctx:n}}});function D(_){n[37](_)}function S(_){n[38](_)}let K={hidden:n[3]!==null||n[1]==="webcam",filetype:n[1]==="clipboard"?"clipboard":"image/*",root:n[13],max_file_size:n[15],disable_click:!n[9].includes("upload")||n[3]!==null,upload:n[16],stream_handler:n[17],aria_label:n[14]("image.drop_to_upload"),$$slots:{default:[tl]},$$scope:{ctx:n}};n[0]!==void 0&&(K.uploading=n[0]),n[2]!==void 0&&(K.dragging=n[2]),s=new Vt({props:K}),n[36](s),oe.push(()=>pe(s,"uploading",D)),oe.push(()=>pe(s,"dragging",S)),s.$on("load",n[26]),s.$on("error",n[39]);const G=[nl,il,ll],C=[];function X(_,v){return _[1]==="webcam"&&!_[10]&&_[4]?0:_[1]==="webcam"&&(_[10]||!_[10]&&!_[3])?1:_[3]!==null&&!_[10]?2:-1}~(d=X(n))&&(k=C[d]=G[d](n));let T=O&&Je(n);return{c(){j(e.$$.fragment),t=F(),l=N("div"),j(i.$$.fragment),r=F(),a=N("div"),j(s.$$.fragment),f=F(),k&&k.c(),y=F(),T&&T.c(),this.h()},l(_){P(e.$$.fragment,_),t=A(_),l=U(_,"DIV",{"data-testid":!0,class:!0});var v=B(l);P(i.$$.fragment,v),r=A(v),a=U(v,"DIV",{class:!0});var H=B(a);P(s.$$.fragment,H),f=A(H),k&&k.l(H),H.forEach(b),y=A(v),T&&T.l(v),v.forEach(b),this.h()},h(){g(a,"class","upload-container svelte-1hdlew6"),$(a,"reduced-height",n[9].length>1),be(a,"width",n[3]?"auto":"100%"),g(l,"data-testid","image"),g(l,"class","image-container svelte-1hdlew6")},m(_,v){R(e,_,v),V(_,t,v),V(_,l,v),R(i,l,null),z(l,r),z(l,a),R(s,a,null),z(a,f),~d&&C[d].m(a,null),z(l,y),T&&T.m(l,null),n[49](l),m=!0,p||(I=[ae(a,"dragover",n[32]),ae(a,"drop",n[33])],p=!0)},p(_,v){const H={};v[0]&256&&(H.show_label=_[8]),v[0]&128&&(H.label=_[7]||"Image"),e.$set(H);const L={};v[0]&3670024|v[1]&524288&&(L.$$scope={dirty:v,ctx:_}),i.$set(L);const M={};v[0]&10&&(M.hidden=_[3]!==null||_[1]==="webcam"),v[0]&2&&(M.filetype=_[1]==="clipboard"?"clipboard":"image/*"),v[0]&8192&&(M.root=_[13]),v[0]&32768&&(M.max_file_size=_[15]),v[0]&520&&(M.disable_click=!_[9].includes("upload")||_[3]!==null),v[0]&65536&&(M.upload=_[16]),v[0]&131072&&(M.stream_handler=_[17]),v[0]&16384&&(M.aria_label=_[14]("image.drop_to_upload")),v[0]&8|v[1]&524288&&(M.$$scope={dirty:v,ctx:_}),!o&&v[0]&1&&(o=!0,M.uploading=_[0],ve(()=>o=!1)),!c&&v[0]&4&&(c=!0,M.dragging=_[2],ve(()=>c=!1)),s.$set(M);let Q=d;d=X(_),d===Q?~d&&C[d].p(_,v):(k&&(ee(),E(C[Q],1,1,()=>{C[Q]=null}),te()),~d?(k=C[d],k?k.p(_,v):(k=C[d]=G[d](_),k.c()),w(k,1),k.m(a,null)):k=null),(!m||v[0]&512)&&$(a,"reduced-height",_[9].length>1),v[0]&8&&be(a,"width",_[3]?"auto":"100%"),v[0]&512&&(O=_[9].length>1||_[9].includes("clipboard")),O?T?(T.p(_,v),v[0]&512&&w(T,1)):(T=Je(_),T.c(),w(T,1),T.m(l,null)):T&&(ee(),E(T,1,1,()=>{T=null}),te())},i(_){m||(w(e.$$.fragment,_),w(i.$$.fragment,_),w(s.$$.fragment,_),w(k),w(T),m=!0)},o(_){E(e.$$.fragment,_),E(i.$$.fragment,_),E(s.$$.fragment,_),E(k),E(T),m=!1},d(_){_&&(b(t),b(l)),q(e,_),q(i),n[36](null),q(s),~d&&C[d].d(),T&&T.d(),n[49](null),p=!1,Ke(I)}}}function al(n,e,t){let l,{$$slots:i={},$$scope:r}=e,{value:a=null}=e,{label:s=void 0}=e,{show_label:o}=e,{sources:c=["upload","clipboard","webcam"]}=e,{streaming:f=!1}=e,{pending:d=!1}=e,{webcam_options:k}=e,{selectable:y=!1}=e,{root:O}=e,{i18n:m}=e,{max_file_size:p=null}=e,{upload:I}=e,{stream_handler:D}=e,{stream_every:S}=e,{modify_stream:K}=e,{set_time_limit:G}=e,{show_fullscreen_button:C=!0}=e,X,{uploading:T=!1}=e,{active_source:_=null}=e,{fullscreen:v=!1}=e,H=[],L;async function M({detail:u}){var ne;if(!f){if((ne=u.path)!=null&&ne.toLowerCase().endsWith(".svg")&&u.url){const de=await(await fetch(u.url)).text();t(3,a={...u,url:`data:image/svg+xml,${encodeURIComponent(de)}`})}else t(3,a=u);await ye(),Y("upload")}}function Q(){t(3,a=null),Y("clear"),Y("change",null)}function De(u){Q(),u.stopPropagation()}async function re(u,ne){if(ne==="stream"){Y("stream",{value:{url:u},is_value_data:!0});return}t(24,L=Math.random().toString(36).substring(2,15));const se=new File([u],`image.${f?"jpeg":"png"}`);t(23,H=[new bt({path:se.name,orig_name:se.name,blob:se,size:se.size,mime_type:se.type,is_stream:!1})]),t(4,d=!0);const de=await X.load_files([se],L);(ne==="change"||ne==="upload")&&(t(3,a=(de==null?void 0:de[0])||null),await ye(),Y("change")),t(4,d=!1)}const Y=Oe();let{dragging:J=!1}=e;function ze(u){let ne=Tt(u);ne&&Y("select",{index:ne,value:null})}async function Te(u){switch(u){case"clipboard":X.paste_clipboard();break}}let fe;function Be(u){u.preventDefault(),u.stopPropagation(),u.dataTransfer&&(u.dataTransfer.dropEffect="copy"),t(2,J=!0)}async function Ve(u){u.preventDefault(),u.stopPropagation(),t(2,J=!1),a&&(Q(),await ye()),t(1,_="upload"),await ye(),X.load_files_from_drop(u)}function Ne(u){me.call(this,n,u)}function h(u){oe[u?"unshift":"push"](()=>{X=u,t(22,X)})}function W(u){T=u,t(0,T)}function Z(u){J=u,t(2,J)}function ie(u){me.call(this,n,u)}function _e(u){K=u,t(5,K)}function Ue(u){G=u,t(6,G)}const Ce=u=>re(u.detail,"change"),Xe=u=>re(u.detail,"stream");function Ye(u){me.call(this,n,u)}function Ze(u){me.call(this,n,u)}const $e=u=>re(u.detail,"upload");function xe(u){me.call(this,n,u)}function et(u){_=u,t(1,_),t(9,c)}function tt(u){oe[u?"unshift":"push"](()=>{fe=u,t(25,fe)})}return n.$$set=u=>{"value"in u&&t(3,a=u.value),"label"in u&&t(7,s=u.label),"show_label"in u&&t(8,o=u.show_label),"sources"in u&&t(9,c=u.sources),"streaming"in u&&t(10,f=u.streaming),"pending"in u&&t(4,d=u.pending),"webcam_options"in u&&t(11,k=u.webcam_options),"selectable"in u&&t(12,y=u.selectable),"root"in u&&t(13,O=u.root),"i18n"in u&&t(14,m=u.i18n),"max_file_size"in u&&t(15,p=u.max_file_size),"upload"in u&&t(16,I=u.upload),"stream_handler"in u&&t(17,D=u.stream_handler),"stream_every"in u&&t(18,S=u.stream_every),"modify_stream"in u&&t(5,K=u.modify_stream),"set_time_limit"in u&&t(6,G=u.set_time_limit),"show_fullscreen_button"in u&&t(19,C=u.show_fullscreen_button),"uploading"in u&&t(0,T=u.uploading),"active_source"in u&&t(1,_=u.active_source),"fullscreen"in u&&t(20,v=u.fullscreen),"dragging"in u&&t(2,J=u.dragging),"$$scope"in u&&t(50,r=u.$$scope)},n.$$.update=()=>{n.$$.dirty[0]&514&&!_&&c&&t(1,_=c[0]),n.$$.dirty[0]&1026&&t(21,l=f&&_==="webcam"),n.$$.dirty[0]&2097153&&T&&!l&&t(3,a=null),n.$$.dirty[0]&4&&Y("drag",J)},[T,_,J,a,d,K,G,s,o,c,f,k,y,O,m,p,I,D,S,C,v,l,X,H,L,fe,M,Q,De,re,ze,Te,Be,Ve,i,Ne,h,W,Z,ie,_e,Ue,Ce,Xe,Ye,Ze,$e,xe,et,tt,r]}class ol extends we{constructor(e){super(),ke(this,e,al,rl,Ie,{value:3,label:7,show_label:8,sources:9,streaming:10,pending:4,webcam_options:11,selectable:12,root:13,i18n:14,max_file_size:15,upload:16,stream_handler:17,stream_every:18,modify_stream:5,set_time_limit:6,show_fullscreen_button:19,uploading:0,active_source:1,fullscreen:20,dragging:2},null,[-1,-1])}}const vl=ol;export{Ot as C,vl as I,xt as W};
//# sourceMappingURL=ImageUploader.Cj6tTOQI.js.map
